# Проэктирование логической модели DWH.

Здесь представлено решение практического задания 5 модуля курса "Инженер данных" от Karpov Courses.
Необходимо спроектировать и описать в ER диаграммах и текстовых пояснениях какую-то предметную область.

### Предметная область.
Рассмотрим модель данных DWH онлайн кинотеатра.
Построенные на основе данных хранилища витрины должны помогать отвечать на простые вопросы:
* Кто наш пользователь?
    + Из какой географической зоны
    + Как зарегистрировался
    + Из какой соц.-дем. группы  
* Что пользователь покупает на нашем сервисе?
* Что и как (с какого устройства) пользователь смотрит на нашем сервисе?

А также на комбинированные вопросы типа: 
* Какие группы пользователей (по разным наборам признаков) за какой контент предпочитают платить?
* Какие группы пользователей (по разным наборам признаков) какой контент предпочитают смотреть?

Ответы на вопросы из первой группы можно получить, создав простые витрины на основе основных сущностей хранилища (описание сущностей ниже). 
Ответы на комбинированные вопросы могут дать специальные витрины. Например витрина под названием dm_content_watch в [dimensional_modelling.drawio] поможет ответить на 1 комбинированный вопрос, витрина под названием dm_payment в [dimensional_modelling.drawio] поможет ответить на 2 комбинированный вопрос. Вид этих витрин будет такой же в методолгиях Anchor Modelling и Data Vault.

### ER-диаграммы с пояснениями
* [dimensional_modelling.drawio] - методология Dimensional Modelling
    + Дополнительно к самим объектам приведен вид возможных витрин - dm_content_watch, dm_payment. О них было упомянуто выше.
* [data_vault_modelling.drawio] - методология Data Vault
    + p_profile, p_content - pit таблицы для соответствующих сущностей
    + b_place - bridge таблица, объединяющая в себе информацию о географической зоне
* [anchor_modelling.drawio] - методология Anchor Modelling

Предполагается что схемы будут открываться в [draw.io], можно скачать файл локально, можно использовать нативную интеграцию с [github]

### Объекты
Описания объектов приведены так, будто имеем дело с dimencion modeling для начала.
**Profile** - справочник (измерение) профилей пользователя. Профиль появляется  при регистрации в системе.

| Атрибут | объяснение |
| ------ | ------ |
| id | id |
| mail | эл.почта |
| phone | телефон |
| phone_country | страна телефона |
| vk | ссылка на аккаунт vk или внутренниу vk_id |
| ok | ссылка на аккаунт ok или внутренниу ok_id |
| yandex | ссылка на аккаунт yandex или внутренниу yandex_id |
| gender | пол |
| age | возраст |
| place_code | ссылка на географическую зону откуда произошла регистрация |
| balance | остаток денег на профиле |
| place_code | валюта денег профиля |

Атрибуты mail, phone, vk, ok, yandex по отдельности могут быть использованы при регистрации и в совокупности могут составлять бизнес ключ, идентифицирующий профиль.

**Place** - справочник (измерение) географических зон.
| Атрибут | объяснение |
| ------ | ------ |
| code | код географической зоны |
| post_code | почтовый код |
| continent | континент |
| country | страна |
| subdivision | единица административного деления страны (штат, округ, область, республика, край...) |
| city | город |
| area | район города |

**Device** - справочник (измерение) устройств пользователей, с которых происходят просмотры контента.
| Атрибут | объяснение |
| ------ | ------ |
| id | id |
| type | тип устройства (смартфон, компьютер, телевизор...) |
| manufacturer | производитель устройства |
| manufacturer_code | код устройства от производителя |
| model | модель устройства |
| diagonal | длина диагонали экрана устройства |
| prod_year | год выпуска устройства |

Атрибуты manufacturer и manufacturer_code могут представлять из себя бизнес ключ, идентифицирующий устройство.

**Content** - справочник (измерение) контента.
| Атрибут | объяснение |
| ------ | ------ |
| id | id |
| name | название |
| type | тип (фильм, мультфильм, сериал, сезон сериала, серия сериала, трейлер...) |
| duration | длительность |
| description | описание |
| imdb | оценка в imdb |
| kinopoisk | оценка в кинопоиске |
| parent_content_id | id родительского контента (сезона для серии, сериала для сезона, фильма/мультфильма для трейлера) |

Атрибуты name и type могут представлять из себя бизнес ключ, идентифицирующий контент.

**Content_watch** - факт просмотра контента.
| Атрибут | объяснение |
| ------ | ------ |
| profile_id | id профиля на котором котором был просмотр|
| device_id | id устройства с которого был просмотр |
| content_id | id контента который смотрели |
| start_time | дата+время начала просмотра |
| ip | ip с которого шел просмотр |
| mac | mac адрес устройства с которого шел просмотр |
| diration | длительность просмотра |

Атрибуты profile_id, device_id, content_id, start_time уникально идентифицируют просмотр.

**Payment** - факт оплаты.
| Атрибут | объяснение |
| ------ | ------ |
| content_id | id контента который купили (или пустота если это оплата подписки) |
| profile_id | id профиля покупателя |
| dttm | дата+время покупки |
| type | тип покупки (покупка контента/оплата подписки) |
| payment_system | платежная система |
| amount | сумма покупки |
| currency | валюта покупки |

Атрибуты profile_id, content_id, dttm уникально идентифицируют покупку.

   [dimensional_modelling.drawio]: <https://github.com/MaslovGennady/karpov_de_course/blob/main/module5/dimensional_modelling.drawio>
   [data_vault_modelling.drawio]: <https://github.com/MaslovGennady/karpov_de_course/blob/main/module5/data_vault_modelling.drawio>
   [anchor_modelling.drawio]: 
   <https://github.com/MaslovGennady/karpov_de_course/blob/main/module5/anchor_modelling.drawio>   
   [draw.io]:
   <https://app.diagrams.net/>
   [github]:
   <https://www.draw.io/?mode=github>
